<!-- HTML code to be injected just before the closing body tag --> 

<script>
window.addEventListener('load', function(event) {
  const keyBtn = 'urantiapedia-button-';
  const keyCol = 'urantiapedia-column-';
  let visibility = [true, true, true, true];
  const upcontents = document.querySelector('.contents');
  const multiVersion = (upcontents && document.querySelector(`#${keyBtn}1`));

  function writeCookie(key, value) {
    const date = new Date();
    date.setTime(+ date + (365 * 24 * 60 * 60 * 1000));
    document.cookie = `${key}=${value}; expires=${date.toGMTString()}; path=/`;
    return value;
  };

  function getCookie(key) {
    let name = key + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for(let i = 0; i < ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  };

  function setVisible(index, visible) {
    const nodes = document.querySelectorAll(`.contents div.${keyCol}${index + 1}`);
    const hidden = !visible;
    nodes.forEach(n => n.classList.toggle('d-none', hidden));
    const onlyOne = (visibility.filter(v=> v == true).length === 1);
    if (upcontents) {
      upcontents.classList.toggle('urantiapedia-full-width', !onlyOne);
    }
    const icon = document.querySelector(`#${keyBtn}${index + 1} i`);
    if (icon) {
      icon.classList.toggle('mdi-radiobox-marked', !hidden);
      icon.classList.toggle('mdi-radiobox-blank', hidden);
    }
  };

  if (multiVersion) {
      try {
        upcontents.classList.add('urantiapedia-full-width');

        const cookie = getCookie('visibility');
        if (cookie && cookie.split(',').length === 4) {
          visibility = cookie.split(',').map(v => v == 'false' ? false : true);
          if (visibility.indexOf(true) === -1) visibility = [true, true, true, true];
          visibility.forEach((visible, n) => setVisible(n, visible));
        }
      } catch (er) {}

      [1,2,3,4].forEach(n => {
        const btn = document.querySelector(`#${keyBtn}${n}`);
        if (!btn) return;
        btn.addEventListener('click', (evt) => {
          try {
            const target = (evt.target.id.startsWith(keyBtn) ? evt.target : 
              (evt.target.parentNode.id.startsWith(keyBtn) ? evt.target.parentNode : null)
            );
            if (!target) return;
            const index = parseInt(target.id.split('-')[2]);
            if (isNaN(index)) return;
            const nodes = document.querySelectorAll(`.contents div.${keyCol}${index}`);
            const onlyOne = (visibility.filter(v=> v == true).length === 1);
            if (visibility[index - 1] && onlyOne) return;
            visibility[index - 1] = !visibility[index - 1];
            setVisible(index - 1, visibility[index - 1]);
            writeCookie('visibility', visibility.join(','));
            evt.stopPropagation();
            evt.preventDefault();
          } catch (er) {}
        });
      });
    }

});
</script>